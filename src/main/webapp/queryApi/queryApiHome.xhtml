<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html [
  <!ENTITY times "&#215;">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
  <h:head>
    <!-- ajaxのキャッシュがブラウザに残るとバグるため、キャッシュを残さない設定 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <h:outputStylesheet library="css" name="queryApiStyle.css" target="head" />
    <title>QueryAPIホーム</title>
  </h:head>
  <h:body>

    <h1>QueryAPIホーム</h1>

    <br />

    <button type="button" onclick="openSearchModal()">Todo更新</button><br /><br />

    <button type="button" onclick="openSearchForDelete()">Todo削除</button><br /><br />

    <button type="button" onclick="openAddModal()">Todo追加</button>

    <!-- jsファイルインポート -->
    <h:outputScript library="js" name="queryApiScript.js" target="body" />

    <!-- 検索用モーダル -->
    <div id="searchModal" class="modal">
        <div class="modal-content">
            <!-- &times;は×ボタン -->
            <span class="close" onclick="closeSearchModal()">&times;</span>
            <h3>検索id入力</h3>

            <h:form id="searchForm">
                <h:inputText value="#{queryApiBackingBean.dto.id}" />

                <!-- f:ajaxを使ってモーダル⇒バッキングビーン⇒モーダルを実現 -->
                <!-- 通常バッキングビーンのメソッドの戻り値はString型（xhtmlのパス）だが、Ajaxを使うため、バッキングビーンの戻り値はvoid -->
                <h:commandButton value="検索" action="#{queryApiBackingBean.findById()}">
                    <!-- execute="@form"： フォーム全体の入力値をサーバーに送る-->
                    <!-- render=":updateForm:existsFlag"：部分更新対象のコンポーネントの ID を指定 -->
                    <!-- onevent="afterSearch"：Ajax リクエストのライフサイクルのイベント（begin / complete / success）がJavaScript 関数 afterSearch() に通知される。 -->
                    <!-- 通知を受けたタイミングで受信した関数はキックされる。 -->
                    <!-- begin：Ajaxリクエスト開始（ボタンが押されたとき） -->
                    <!-- complete：サーバー応答を受信したとき -->
                    <!-- success：対象コンポーネントの更新が終わった時 -->
                    <f:ajax execute="@form" render="updateForm"  onevent="afterSearch"/>
                    <!-- 上記の場合、successになる直前にupdateFormのexistsFlagのみが再描画=更新される -->
                </h:commandButton>
            </h:form>
        </div>
    </div>

    <!-- 更新用モーダル -->
    <div id="updateModal" class="modal">
        <div class="modal-content">

            <span class="close" onclick="closeUpdateModal()">&times;</span>
            <h3>更新フォーム</h3>

            <h:form id="updateForm">

                <h:inputHidden value="#{queryApiBackingBean.exists}" id="existsFlag" />

                <h:outputLabel for="id" value="id:" /><br />
                <h:inputText value="#{queryApiBackingBean.dto.id}" id="id" /><br /><br />

                <h:outputLabel for="todo" value="todo:" /><br />
                <h:inputText value="#{queryApiBackingBean.dto.todo}" id="todo" /><br /><br />

                <h:outputLabel for="priority" value="priority:" /><br />
                <h:selectOneMenu value="#{queryApiBackingBean.dto.priority}" id="priority">
                    <f:selectItem itemLabel="低" itemValue="低" />
                    <f:selectItem itemLabel="中" itemValue="中" />
                    <f:selectItem itemLabel="高" itemValue="高" />
                </h:selectOneMenu><br /><br />

                <h:outputLabel for="detail" value="detail:" /><br />
                <h:inputTextarea value="#{queryApiBackingBean.dto.detail}" id="detail" rows="4" cols="40" /><br /><br />

                <h:commandButton value="更新" action="#{queryApiBackingBean.update()}" />

            </h:form>
        </div>
    </div>

    <!-- 削対象検索モーダル -->
    <div id="searchForDelete" class="modal">
        <div class="modal-content">
            <!-- &times;は×ボタン -->
            <span class="close" onclick="closeSearchForDelete()">&times;</span>
            <h3>削除対象のid入力</h3>

            <h:form id="searchForDelete">
                <h:inputText value="#{queryApiBackingBean.dto.id}" />
                <h:commandButton value="検索" action="#{queryApiBackingBean.findById()}">
                    <f:ajax execute="@form" render="deleteForm"  onevent="afterSearchForDelete"/>
                </h:commandButton>
            </h:form>
        </div>
    </div>

    <!-- 削除用モーダル -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">

            <span class="close" onclick="closeDeleteModal()">&times;</span>
            <h3>削除対象詳細</h3>

            <h:form id="deleteForm">

                <h:inputHidden value="#{queryApiBackingBean.exists}" id="existsFlag" />

                <h:outputLabel for="id" value="id:" /><br />
                <h:outputText value="#{queryApiBackingBean.dto.id}" id="id" /><br /><br />

                <h:outputLabel for="todo" value="todo:" /><br />
                <h:outputText value="#{queryApiBackingBean.dto.todo}" id="todo" /><br /><br />

                <h:outputLabel for="priority" value="priority:" /><br />
                <h:outputText value="#{queryApiBackingBean.dto.priority}" id="priority" /><br /><br />

                <h:outputLabel for="detail" value="detail:" /><br />
                <h:outputText value="#{queryApiBackingBean.dto.detail}" id="detail" /><br /><br />

                <h:outputLabel for="userId" value="割当先userId:" /><br />
                <h:outputText value="#{queryApiBackingBean.dto.accountDto.userId}" id="userId" /><br /><br />

                <h:commandButton value="削除" action="#{queryApiBackingBean.delete()}" />

            </h:form>
        </div>
    </div>

    <!-- 追加用モーダル -->
    <div id="addModal" class="modal">
        <div class="modal-content">

            <span class="close" onclick="closeAddModal()">&times;</span>
            <h3>追加フォーム</h3>

            <h:form id="addForm">

                <h:outputLabel for="id" value="id:" /><br />
                <h:inputText value="#{queryApiBackingBean.dto.id}" id="id" /><br /><br />

                <h:outputLabel for="todo" value="todo:" /><br />
                <h:inputText value="#{queryApiBackingBean.dto.todo}" id="todo" /><br /><br />

                <h:outputLabel for="priority" value="priority:" /><br />
                <h:selectOneMenu value="#{queryApiBackingBean.dto.priority}" id="priority">
                    <f:selectItem itemLabel="低" itemValue="低" />
                    <f:selectItem itemLabel="中" itemValue="中" />
                    <f:selectItem itemLabel="高" itemValue="高" />
                </h:selectOneMenu><br /><br />

                <h:outputLabel for="detail" value="detail:" /><br />
                <h:inputTextarea value="#{queryApiBackingBean.dto.detail}" id="detail" rows="4" cols="40" /><br /><br />

                <h:outputLabel for="userId" value="割当先userId:" /><br />
                <h:inputText value="#{queryApiBackingBean.dto.accountDto.userId}" id="userId" /><br /><br />

                <h:commandButton value="追加" action="#{queryApiBackingBean.add()}" />

            </h:form>
        </div>
    </div>

  </h:body>
</html>